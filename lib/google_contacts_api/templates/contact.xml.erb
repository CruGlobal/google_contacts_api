<% if action == :create  %>
<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"
            xmlns:gd="http://schemas.google.com/g/2005"
            xmlns:gContact="http://schemas.google.com/contact/2008">
  <atom:category scheme="http://schemas.google.com/g/2005#kind"
                 term="http://schemas.google.com/contact/2008#contact"/>
<% else %>
<entry gd:etag=<%= contact[:etag].encode(xml: :attr) %>>
 <id><%= contact[:id].encode(xml: :text) %></id>
 <updated>2008-02-28T18:47:02.303Z</updated>
 <category scheme="http://schemas.google.com/g/2005#kind" term="http://schemas.google.com/contact/2008#contact"/>
<% end %>

    <gd:name>
        <%= contact[:name_prefix] ? "<gd:namePrefix>#{contact[:name_prefix].encode(xml: :text)}</gd:namePrefix>" : '' %>
        <%= contact[:given_name] ? "<gd:givenName>#{contact[:given_name].encode(xml: :text)}</gd:givenName>" : '' %>
        <%= contact[:additional_name] ? "<gd:additionalName>#{contact[:additional_name].encode(xml: :text)}</gd:additionalName>" : '' %>
        <%= contact[:family_name] ? "<gd:familyName>#{contact[:family_name].encode(xml: :text)}</gd:familyName>" : '' %>
        <%= contact[:name_suffix] ? "<gd:nameSuffix>#{contact[:name_suffix].encode(xml: :text)}</gd:nameSuffix>" : '' %>
    </gd:name>

    <%= contact[:content] ? "<atom:content>#{contact[:content].encode(xml: :text)}</atom:content>" : '' %>

    <% (contact[:emails] || []).each do |email| %>
      <gd:email rel="http://schemas.google.com/g/2005#<%= email[:rel] %>"
                <%= email[:primary] ? 'primary="true"' : '' %>
                address=<%= email[:address].encode(xml: :attr) %>/>
    <% end %>

    <% (contact[:phone_numbers] || []).each do |phone| %>
      <gd:phoneNumber rel="http://schemas.google.com/g/2005#<%= phone[:rel] %>"
                      <%= phone[:primary] ? 'primary="true"' : '' %>
      ><%= phone[:number].encode(xml: :text) %></gd:phoneNumber>
    <% end %>

    <% (contact[:addresses] || []).each do |address| %>
      <gd:structuredPostalAddress rel="http://schemas.google.com/g/2005#<%= address[:rel] %>"
             <%= address[:primary] ? 'primary="true"' : '' %>>
        <gd:city><%= address[:city].encode(xml: :text) %></gd:city>
        <gd:street><%= address[:street].encode(xml: :text) %></gd:street>
        <gd:region><%= address[:region].encode(xml: :text) %></gd:region>
        <gd:postcode><%= address[:postcode].encode(xml: :text) %></gd:postcode>
        <gd:country><%= address[:country].encode(xml: :text) %></gd:country>
      </gd:structuredPostalAddress>
    <% end %>

    <% (contact[:websites] || []).each do |website| %>
        <gContact:website
            href=<%= website[:href].encode(xml: :attr) %>
            rel=<%= website[:rel].encode(xml: :attr) %>
            <%= website[:primary] ? 'primary="true"' : '' %>
        />
    <% end %>

<% if action != :create  %>
  </entry>
<% else %>
  </atom:entry>
<% end %>