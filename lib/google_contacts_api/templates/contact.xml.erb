<% if action == :create  %>
<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"
            xmlns:gd="http://schemas.google.com/g/2005"
            xmlns:gContact="http://schemas.google.com/contact/2008">
  <atom:category scheme="http://schemas.google.com/g/2005#kind"
                 term="http://schemas.google.com/contact/2008#contact"/>
<% else %>
<entry gd:etag=<%= contact[:etag].encode(xml: :attr) %>>
 <id><%= contact[:id].encode(xml: :text) %></id>
 <updated><%= contact[:updated].encode(xml: :text) %></updated>
 <category scheme="http://schemas.google.com/g/2005#kind" term="http://schemas.google.com/contact/2008#contact"/>
<% end %>

    <gd:name>
        <%= contact[:name_prefix] ? "<gd:namePrefix>#{contact[:name_prefix].encode(xml: :text)}</gd:namePrefix>" : '' %>
        <%= contact[:given_name] ? "<gd:givenName>#{contact[:given_name].encode(xml: :text)}</gd:givenName>" : '' %>
        <%= contact[:additional_name] ? "<gd:additionalName>#{contact[:additional_name].encode(xml: :text)}</gd:additionalName>" : '' %>
        <%= contact[:family_name] ? "<gd:familyName>#{contact[:family_name].encode(xml: :text)}</gd:familyName>" : '' %>
        <%= contact[:name_suffix] ? "<gd:nameSuffix>#{contact[:name_suffix].encode(xml: :text)}</gd:nameSuffix>" : '' %>
    </gd:name>

    <%= contact[:content] ? "<atom:content>#{contact[:content].encode(xml: :text)}</atom:content>" : '' %>

    <% (contact[:emails] || []).each do |email| %>
      <gd:email <%= email[:rel] ? "rel=\"http://schemas.google.com/g/2005##{ email[:rel] }\"" : '' %>
                <%= email[:primary] ? 'primary="true"' : '' %>
                address=<%= email[:address].to_s.encode(xml: :attr) %>/>
    <% end %>

    <% (contact[:phone_numbers] || []).each do |phone| %>
      <gd:phoneNumber <%= phone[:rel] ? "rel=\"http://schemas.google.com/g/2005##{ phone[:rel] }\"" : '' %>
                      <%= phone[:primary] ? 'primary="true"' : '' %>
      ><%= phone[:number].to_s.encode(xml: :text) %></gd:phoneNumber>
    <% end %>

    <% (contact[:addresses] || []).each do |address| %>
      <gd:structuredPostalAddress <%= address[:rel] ? "rel=\"http://schemas.google.com/g/2005##{ address[:rel] }\"" : '' %>
             <%= address[:primary] ? 'primary="true"' : '' %>>
        <gd:city><%= address[:city].to_s.encode(xml: :text) %></gd:city>
        <gd:street><%= address[:street].to_s.encode(xml: :text) %></gd:street>
        <gd:region><%= address[:region].to_s.encode(xml: :text) %></gd:region>
        <gd:postcode><%= address[:postcode].to_s.encode(xml: :text) %></gd:postcode>
        <gd:country><%= address[:country].to_s.encode(xml: :text) %></gd:country>
      </gd:structuredPostalAddress>
    <% end %>

    <% (contact[:organizations] || []).each do |org| %>
       <gd:organization <%= org[:rel] ? "rel=\"http://schemas.google.com/g/2005##{ org[:rel] }\"" : '' %>
                <%= org[:primary] ? 'primary="true"' : '' %>>
          <gd:orgName><%= org[:org_name].to_s.encode(xml: :text) %></gd:orgName>
          <gd:orgTitle><%= org[:org_title].to_s.encode(xml: :text) %></gd:orgTitle>
       </gd:organization>
    <% end %>

    <% (contact[:websites] || []).each do |website| %>
        <gContact:website
            href=<%= website[:href].to_s.encode(xml: :attr) %>
            <%= website[:rel] ?  "rel=#{website[:rel].encode(xml: :attr)}" : '' %>
            <%= website[:primary] ? 'primary="true"' : '' %>
        />
    <% end %>

<% if action != :create  %>
</entry>
<% else %>
</atom:entry>
<% end %>
